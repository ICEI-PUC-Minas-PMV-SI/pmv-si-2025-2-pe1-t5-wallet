<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoalWallet — Entrar</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <main class="container-center">
    <section class="card" role="region" aria-labelledby="titulo">
      <div class="logo">
        <img src="img/logo.png" alt="Logo Goal Wallet" />
        <h1 id="titulo">Goal Wallet</h1>
      </div>

      <h2 style="margin:0 0 18px 0; font-size:20px;">Entrar</h2>


      <form action="#" method="post" novalidate>
        <div class="field">
          <label class="label" for="email">E-mail</label>
          <input class="input" id="email" name="email" type="email" placeholder="seuemail@exemplo.com" required />
        </div>

        <div class="field">
          <label class="label" for="senha">Senha</label>
          <input class="input" id="senha" name="senha" type="password" placeholder="••••••••" required />
        </div>

        <button class="button" type="submit">Entrar</button>
      </form>

      <p class="text-center" style="margin-top:14px; font-size:14px;">
        Não tem conta? <a class="link" href="cadastro.html">Cadastre-se</a>
      </p>
    </section>
  </main>

  <script src="js/utils.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/route-guard.js"></script>
  <script>
    RouteGuard.redirectIfAuthenticated();

    const form = document.querySelector('form');
    const emailInput = document.getElementById('email');
    const senhaInput = document.getElementById('senha');

    emailInput.addEventListener('blur', function() {
      const email = this.value.trim();
      if (email) {
        const isValid = Utils.validateEmail(email);
        Utils.showFieldFeedback(this, isValid, isValid ? '' : 'Email inválido');
      }
    });

    senhaInput.addEventListener('blur', function() {
      const senha = this.value;
      if (senha) {
        const isValid = senha.length > 0;
        Utils.showFieldFeedback(this, isValid, isValid ? '' : 'Digite sua senha');
      }
    });

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      const email = emailInput.value.trim();
      const senha = senhaInput.value;

      if (!email || !senha) {
        Utils.showToast('Preencha todos os campos', 'error');
        return;
      }

      if (!Utils.validateEmail(email)) {
        Utils.showToast('Email inválido', 'error');
        emailInput.focus();
        return;
      }

      Utils.showLoading('Entrando...');

      setTimeout(() => {
        const result = Auth.login(email, senha);

        Utils.hideLoading();

        if (result.success) {
          Utils.showToast(result.message, 'success');
          
          setTimeout(() => {
            window.location.href = 'dashboard.html';
          }, 500);
        } else {
          Utils.showToast(result.message, 'error');
          
          senhaInput.value = '';
          senhaInput.focus();
        }
      }, 500);
    });
  </script>
</body>
</html>
